{% extends "base.html" %}
{% load static %}
{% block content %}

<style type="text/css">
	.text-leave{
		color: #ffbc34 !important;
	}
	.text-grey{
		color: #808080 !important;
	}
</style>
<div class="content container-fluid">

	<div class="page-header">
		<div class="row">
			<div class="col-sm-12">
				<h3 class="page-title">Monthly Overview</h3>
				<ul class="breadcrumb">
					<li class="breadcrumb-item"><a href="{% url 'admin-dashboard' %}">Dashboard</a></li>
					<li class="breadcrumb-item active">Monthly Overview</li>
				</ul>
			</div>
		</div>
	</div>

	<form id="search_attendance" action="#" ondragstart="return false;" ondrop="return false;" enctype="multipart/form-data">
	{% csrf_token %}
	<div class="row filter-row">
		<div class="col-sm-6 col-md-3">
			<div class="input-block mb-3 form-focus">
				<input type="text" class="form-control floating" name="employee_name" id="employee_name">
				<label class="focus-label">Employee Name</label>
			</div>
		</div>
		<div class="col-sm-6 col-md-3">
			<div class="input-block mb-3 form-focus select-focus">
				<select class="select floating" name="month" id="month">
				    <option value="1" {% if month == 1 %}selected{% endif %}>January</option>
				    <option value="2" {% if month == 2 %}selected{% endif %}>February</option>
				    <option value="3" {% if month == 3 %}selected{% endif %}>March</option>
				    <option value="4" {% if month == 4 %}selected{% endif %}>April</option>
				    <option value="5" {% if month == 5 %}selected{% endif %}>May</option>
				    <option value="6" {% if month == 6 %}selected{% endif %}>June</option>
				    <option value="7" {% if month == 7 %}selected{% endif %}>July</option>
				    <option value="8" {% if month == 8 %}selected{% endif %}>August</option>
				    <option value="9" {% if month == 9 %}selected{% endif %}>September</option>
				    <option value="10" {% if month == 10 %}selected{% endif %}>October</option>
				    <option value="11" {% if month == 11 %}selected{% endif %}>November</option>
				    <option value="12" {% if month == 12 %}selected{% endif %}>December</option>
				</select>
				<label class="focus-label">Select Month</label>
			</div>
		</div>
		<div class="col-sm-6 col-md-3">
			<div class="input-block mb-3 form-focus select-focus">
				<select class="select floating" name="year" id="year">
					<!-- <option value="2023" {% if year == 2023 %}selected{% endif %}>2023</option> -->
					<option value="2024" {% if year == 2024 %}selected{% endif %}>2024</option>
					<option value="2025" {% if year == 2025 %}selected{% endif %}>2025</option>
					<option value="2026" {% if year == 2026 %}selected{% endif %}>2026</option>
				</select>
				<label class="focus-label">Select Year</label>
			</div>
		</div>
		<div class="col-sm-6 col-md-3">
			<div class="d-grid">
				<a href="javascript:void(0)" class="btn btn-success" id="search"> Search </a>
			</div>
		</div>
	</div>
	</form>
	<style type="text/css">
		#selected_attendance table th:not(:first-child) {
		  text-align: center;
		}
	</style>
	<div class="row">
		<div class="col-lg-12">
			<div class="table-responsive" id="selected_attendance">
				<table class="table table-striped custom-table table-nowrap mb-0">
					<thead>
						<tr>
							<th>Employee</th>			
							{% for number in numbers %}
							    <th>{{ number }}</th>
							{% endfor %}
						</tr>
					</thead>
					<tbody>
						{% for employee in employee_data_list %}
						<tr>
							<td>
								<h2 class="table-avatar">
									<a class="avatar avatar-xs" href="{% url 'profile' employee.id %}">
										{% if employee.image_url|length > 0 %}
                                        <img src="{{ employee.image_url }}" alt="User Image">
	                                    {% else %}
	                                        <img src="{% static 'assets/img/user/dummy-profile-pic.jpg' %}" alt="Close Icon">
	                                    {% endif %}
									</a>
									<a href="{% url 'profile' employee.id %}">
										{% if employee.first_name and employee.last_name %}
		                                {{ employee.first_name }} {{ employee.last_name }}
		                                {% else %}
		                                {{ employee.user_name }}
		                                {% endif %}
									</a>
								</h2>
							</td>
							{% if employee.attendance %}
								{% for att in employee.attendance %}
									{% if att.in_time %}
								        <td data-bs-toggle="tooltip" title="{{ att.status }}"><a href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#attendance_info"><i class="fa-solid fa-check text-success"></i></a></td>
								    {% else %}
								        <td data-bs-toggle="tooltip" title="{{ att.status|default:'Holiday' }}"><i class="fa fa-close text-danger"></i> </td>
								    {% endif %}
								{% endfor %}
							{% else %}
						        {% for key_id,date_information in employee_holiday.items %}
									{% if employee.id == key_id %}
										{% for date_info in date_information %}
						            		{% if date_info.is_weekend or date_info.is_holiday or date_info.is_leave or date_info.is_half_day_leave %}
						            			{% if date_info.is_half_day_leave %}
						            				{% if date_info.half_day_type == 2 %}
						            					<td>
														<div class="half-day">
														<span class="first-off"><i class="fa fa-close text-leave"></i></span>
														<span class="first-off"><a href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#attendance_info"><i class="fa-solid fa-check text-success"></i></a></span>
														</div>
														</td>
													{% elif date_info.half_day_type == 3 %}
														<td data-bs-toggle="tooltip" title="{{ att.status|default:'Holiday' }}">
															<div class="half-day">
															<span class="first-off"><a href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#attendance_info"><i class="fa-solid fa-check text-success"></i></a></span>
															<span class="first-off"><i class="fa fa-close text-leave"></i></span>
															</div>
														</td>
													{% elif date_info.is_leave %}
														<td data-bs-toggle="tooltip" title="{{ att.status|default:'Leave' }}"><i class="fa fa-close text-leave"></i> </td>
						            				{% else %}
							            				<td data-bs-toggle="tooltip" title="{{ att.status|default:'Holiday' }}"><i class="fa fa-close text-danger"></i> </td>
							            			{% endif %}
							                    {% elif date_info.is_weekend  %}
														<td data-bs-toggle="tooltip" title="{{ att.status|default:'Weekend' }}"><i class="fa fa-close text-grey"></i> </td>
						            			{% elif date_info.is_leave %}
													<td data-bs-toggle="tooltip" title="{{ att.status|default:'Leave' }}"><i class="fa fa-close text-leave"></i> </td>
						            			{% else %}
						            				<td data-bs-toggle="tooltip" title="{{ att.status|default:'Holiday' }}"><i class="fa fa-close text-danger"></i> </td>
						            			{% endif %}
						            		{% else %}
						            			<td data-bs-toggle="tooltip" title="{{ att.status }}"><a href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#attendance_info"><i class="fa-solid fa-check text-success"></i></a></td> 
						            		{% endif %}
										{% endfor %}
									{% endif %}
								{% endfor %}				
							{% endif %}
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>


<div class="modal custom-modal fade" id="attendance_info" role="dialog">
	<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Attendance Info</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-md-6">
						<div class="card punch-status">
							<div class="card-body">
								<h5 class="card-title">Timesheet <small class="text-muted">11 Mar 2019</small></h5>
								<div class="punch-det">
									<h6>Punch In at</h6>
									<p>Wed, 11th Mar 2019 10.00 AM</p>
								</div>
								<div class="punch-info">
									<div class="punch-hours">
										<span>3.45 hrs</span>
									</div>
								</div>
								<div class="punch-det">
									<h6>Punch Out at</h6>
									<p>Wed, 20th Feb 2019 9.00 PM</p>
								</div>
								<div class="statistics">
									<div class="row">
										<div class="col-md-6 col-6 text-center">
											<div class="stats-box">
												<p>Break</p>
												<h6>1.21 hrs</h6>
											</div>
										</div>
										<div class="col-md-6 col-6 text-center">
											<div class="stats-box">
												<p>Overtime</p>
												<h6>3 hrs</h6>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card recent-activity">
							<div class="card-body">
								<h5 class="card-title">Activity</h5>
								<ul class="res-activity-list">
									<li>
										<p class="mb-0">Punch In at</p>
										<p class="res-activity-time">
											<i class="fa-regular fa-clock"></i>
											10.00 AM.
										</p>
									</li>
									<li>
										<p class="mb-0">Punch Out at</p>
										<p class="res-activity-time">
											<i class="fa-regular fa-clock"></i>
											11.00 AM.
										</p>
									</li>
									<li>
										<p class="mb-0">Punch In at</p>
										<p class="res-activity-time">
											<i class="fa-regular fa-clock"></i>
											11.15 AM.
										</p>
									</li>
									<li>
										<p class="mb-0">Punch Out at</p>
										<p class="res-activity-time">
											<i class="fa-regular fa-clock"></i>
											1.30 PM.
										</p>
									</li>
									<li>
										<p class="mb-0">Punch In at</p>
										<p class="res-activity-time">
											<i class="fa-regular fa-clock"></i>
											2.00 PM.
										</p>
									</li>
									<li>
										<p class="mb-0">Punch Out at</p>
										<p class="res-activity-time">
											<i class="fa-regular fa-clock"></i>
											7.30 PM.
										</p>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $(document).ready(function(){
        $('#search').click(function() {
            var employee_name = $("#employee_name").val();
            var month = $("#month").val();
            console.log(month);
            if(month !=''){
                $.ajax({
                    // type: "POST",
                    url: '{% url "search_attendance" %}',
                    data: $("#search_attendance").serialize(),
                    success: function(response) {
                        $('#selected_attendance').html(response);
                    },
                    error: function(xhr, errmsg, err) {
                        console.log('Error: ' + errmsg);
                    }
                });
            }else{
                alert("Please select month");
            }
        });
    });
</script>
{% endblock %}

			

